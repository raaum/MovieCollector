!function(t,e){"function"==typeof define&&define.amd?define(["underscore","backbone"],function(r,o){return e(r||t._,o||t.Backbone)}):e(_,Backbone)}(this,function(t,e){function r(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function o(){return r()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r()}return e.LocalStorage=window.Store=function(t){this.name=t;var e=this.localStorage().getItem(this.name);this.records=e&&e.split(",")||[]},t.extend(e.LocalStorage.prototype,{save:function(){this.localStorage().setItem(this.name,this.records.join(","))},create:function(t){return t.id||(t.id=o(),t.set(t.idAttribute,t.id)),this.localStorage().setItem(this.name+"-"+t.id,JSON.stringify(t)),this.records.push(t.id.toString()),this.save(),this.find(t)},update:function(e){return this.localStorage().setItem(this.name+"-"+e.id,JSON.stringify(e)),t.include(this.records,e.id.toString())||this.records.push(e.id.toString()),this.save(),this.find(e)},find:function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t.id))},findAll:function(){return t(this.records).chain().map(function(t){return this.jsonData(this.localStorage().getItem(this.name+"-"+t))},this).compact().value()},destroy:function(e){return e.isNew()?!1:(this.localStorage().removeItem(this.name+"-"+e.id),this.records=t.reject(this.records,function(t){return t===e.id.toString()}),this.save(),e)},localStorage:function(){return localStorage},jsonData:function(t){return t&&JSON.parse(t)}}),e.LocalStorage.sync=window.Store.sync=e.localSync=function(t,r,o){var n,i,c=r.localStorage||r.collection.localStorage,a=$.Deferred&&$.Deferred();try{switch(t){case"read":n=void 0!=r.id?c.find(r):c.findAll();break;case"create":n=c.create(r);break;case"update":n=c.update(r);break;case"delete":n=c.destroy(r)}}catch(s){i=s.code===DOMException.QUOTA_EXCEEDED_ERR&&0===window.localStorage.length?"Private browsing is unsupported":s.message}return n?(o&&o.success&&("0.9.10"===e.VERSION?o.success(r,n,o):o.success(n)),a&&a.resolve(n)):(i=i?i:"Record Not Found",o&&o.error&&("0.9.10"===e.VERSION?o.error(r,i,o):o.error(i)),a&&a.reject(i)),o&&o.complete&&o.complete(n),a&&a.promise()},e.ajaxSync=e.sync,e.getSyncMethod=function(t){return t.localStorage||t.collection&&t.collection.localStorage?e.localSync:e.ajaxSync},e.sync=function(t,r,o){return e.getSyncMethod(r).apply(this,[t,r,o])},e.LocalStorage});